<!DOCTYPE html>
<html>
<head>
    <title>Select Backend</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        form { margin: 20px 0; }
        select { padding: 8px; width: 300px; margin-right: 10px; }
        button { padding: 8px 16px; background-color: #0d6efd; color: white; border: none; cursor: pointer; }
        #message { margin-top: 10px; padding: 10px; display: none; }
        .success { background-color: #dff0d8; color: #3c763d; }
        .error { background-color: #f2dede; color: #a94442; }
    </style>
</head>
<body>
    <h1>Select Backend for Frontend</h1>
    <form id="backendForm" method="POST" action="/save-backend">
        <label for="backendSelect">Choose Backend:</label>
        <select id="backendSelect" name="backend">
            <!-- Options will be populated dynamically -->
        </select>
        <button type="submit">Save Selection</button>
    </form>
    <p>Selected Backend: <span id="selectedBackend"></span></p>
    <div id="message"></div>

    <script>
        async function loadBackends() {
            try {
                const response = await fetch('available-backends.txt');
                const backends = await response.text();
                const backendArray = backends.split('\n').filter(b => b.trim().length > 0);

                const select = document.getElementById("backendSelect");
                backendArray.forEach(backend => {
                    const option = document.createElement("option");
                    option.value = backend + ".eph.digitalzone-dev.net";
                    option.textContent = backend;
                    select.appendChild(option);
                });

                // Load current selection if available
                try {
                    const currentResponse = await fetch('selected-backend.txt');
                    const currentBackend = await currentResponse.text();
                    if (currentBackend.trim()) {
                        select.value = currentBackend.trim();
                        document.getElementById("selectedBackend").textContent = currentBackend.trim();
                    }
                } catch (err) {
                    console.log("No current selection found");
                }
            } catch (error) {
                console.error("Error loading backends:", error);
                showMessage("Failed to load available backends", false);
            }
        }

        function showMessage(text, isSuccess) {
            const msgElement = document.getElementById("message");
            msgElement.textContent = text;
            msgElement.className = isSuccess ? "success" : "error";
            msgElement.style.display = "block";
        }

        document.getElementById("backendForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            
            const selectedBackend = document.getElementById("backendSelect").value;
            document.getElementById("selectedBackend").textContent = selectedBackend;
            
            try {
                const formData = new FormData();
                formData.append("backend", selectedBackend);
                
                const response = await fetch("save-backend.txt", {
                    method: "POST",
                    body: formData
                });
                
                if (response.ok) {
                    showMessage("Backend selection saved successfully!", true);
                } else {
                    showMessage("Failed to save backend selection", false);
                }
            } catch (error) {
                console.error("Error saving selection:", error);
                showMessage("Error saving selection", false);
            }
        });

        document.addEventListener("DOMContentLoaded", loadBackends);
    </script>
</body>
</html>